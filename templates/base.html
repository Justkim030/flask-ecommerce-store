<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Tech Accessories Kenya{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script>
        // Apply theme from localStorage on page load to prevent flashing
        (function() {
            const theme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', theme);
        })();
    </script>
</head>
<body>
    {# The bg-white class is now controlled by CSS variables, but we keep navbar-light for text color hints #}
    <nav class="navbar navbar-expand-lg navbar-light">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('home') }}">
                <i class="fas fa-laptop-house fa-2x me-2"></i>
                Tech Accessories Kenya
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <!-- Search Form -->
                <form class="d-flex mx-auto my-2 my-lg-0" action="{{ url_for('home') }}" method="get">
                    <input class="form-control me-2" type="search" name="q" id="search-input" placeholder="Search for products..." aria-label="Search" value="{{ search_query or '' }}">
                    <button class="btn btn-outline-danger" type="submit">Search</button>
                </form>

                <div class="navbar-nav ms-lg-3 d-flex align-items-center">
                    <a class="nav-link" href="#">Help Center</a>
                    {% if session.username %}
                        <a class="nav-link" href="{{ url_for('orders') }}">My Orders</a>
                    {% endif %}
                    <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#contactModal">Contact Us</a>
                    <!-- Cart Dropdown -->
                    <div class="dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="cartDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-shopping-cart"></i> Cart
                            {% if cart_item_count > 0 %}
                                <span class="badge rounded-pill bg-danger ms-1">{{ cart_item_count }}</span>
                            {% endif %}
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="cartDropdown" style="min-width: 350px;">
                            {% if cart_item_count > 0 %}
                                <li><h6 class="dropdown-header">Cart Items ({{ cart_item_count }})</h6></li>
                                <li><hr class="dropdown-divider"></li>
                                {% for item in cart_items %}
                                <li>
                                    <div class="dropdown-item d-flex align-items-center">
                                        <img src="{{ url_for('static', filename=item.image) }}" alt="{{ item.name }}" style="width: 40px; height: 40px; object-fit: cover; margin-right: 10px;" onerror="this.src='{{ url_for('static', filename='images/pc.webp') }}'">
                                        <div class="flex-grow-1">
                                            <div class="fw-bold small">{{ item.name[:30] }}{% if item.name|length > 30 %}...{% endif %}</div>
                                            <div class="text-muted small">Qty: {{ item.quantity }} Ã— KSh {{ "%.0f"|format(item.price) }}</div>
                                        </div>
                                        <div class="text-end">
                                            <div class="fw-bold">KSh {{ "%.0f"|format(item.subtotal) }}</div>
                                        </div>
                                    </div>
                                </li>
                                {% endfor %}
                                <li><hr class="dropdown-divider"></li>
                                <li>
                                    <div class="dropdown-item">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <strong>Total:</strong>
                                            <strong>KSh {{ "%.0f"|format(cart_total) }}</strong>
                                        </div>
                                    </div>
                                </li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item text-center" href="{{ url_for('cart') }}">
                                    <i class="fas fa-eye me-2"></i>View Full Cart
                                </a></li>
                                <li><a class="dropdown-item text-center btn btn-primary" href="{{ url_for('checkout') }}" style="color: white; margin: 5px;">
                                    <i class="fas fa-credit-card me-2"></i>Proceed to Checkout
                                </a></li>
                            {% else %}
                                <li><h6 class="dropdown-header">Your cart is empty</h6></li>
                                <li><a class="dropdown-item text-center" href="{{ url_for('home') }}">
                                    <i class="fas fa-shopping-bag me-2"></i>Continue Shopping
                                </a></li>
                            {% endif %}
                        </ul>
                    </div>
                    {% if session.username %}
                        {# This block is for any logged-in user #}
                        {% if session.is_admin %}
                            <li class="nav-item">
                                <a class="nav-link" href="{{ url_for('admin.index') }}">Admin Panel</a>
                            </li>
                        {% endif %}
                        <span class="navbar-text me-2">
                            <i class="fas fa-user me-1"></i>{{ session.username }}
                        </span>
                        <a class="nav-link" href="{{ url_for('logout') }}">Logout</a>
                    {% else %}
                        {# This block is for logged-out users #}
                        <a class="nav-link" href="{{ url_for('login') }}">Login</a>
                        <a class="nav-link" href="{{ url_for('register') }}">Register</a>
                    {% endif %}
                    <button id="theme-switcher" class="theme-switcher ms-3">
                        <i class="fas fa-moon"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>
    <div class="container mt-4">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        {% block content %}{% endblock %}
    </div>

    <!-- Toast for Cart Notifications -->
    <div class="toast-container position-fixed top-0 end-0 p-3">
        <div id="cartToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <i class="fas fa-shopping-cart me-2"></i>
                <strong class="me-auto">Cart Updated</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body">
                Item added to cart successfully!
            </div>
        </div>
    </div>

    <footer class="info-section-wrapper mt-5 py-5">
        <div class="container">
            <div class="row">
                <div class="col-md-3">
                    <h5>Help Center</h5>
                    <ul class="list-unstyled">
                        <li><a href="#">Help Center</a></li>
                        <li><a href="#">Contact Us</a></li>
                        <li><a href="#">How to shop on Tech Kenya</a></li>
                        <li><a href="#">Shipping & Delivery</a></li>
                        <li><a href="#">Return Policy</a></li>
                    </ul>
                </div>
                <div class="col-md-3">
                    <h5>Shopping Guide</h5>
                    <ul class="list-unstyled">
                        <li><a href="#">How to Buy</a></li>
                        <li><a href="#">Track Your Order</a></li>
                        <li><a href="#">Returns & Refunds</a></li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <h5>About Tech Kenya Accessories</h5>
                    <p>Tech Kenya Accessories is your number one online shopping site in Kenya for computer electronics and accessories. We are an online store where you can purchase all your laptops, desktops, peripherals, and gadget needs. We pride ourselves on delivering quality products and excellent customer service right to your doorstep.</p>
                </div>
            </div>
            <hr class="my-4">
            <div class="text-center text-muted">
                <p class="mb-0">&copy; <span id="current-year"></span> Tech Accessories Kenya. All Rights Reserved. | Website built by <a href="https://justkim99.com" target="_blank" rel="noopener noreferrer" class="text-reset">justkim99.com</a></p>
            </div>
        </div>
    </footer>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Theme switcher logic
        document.addEventListener('DOMContentLoaded', function () {
            const themeSwitcher = document.getElementById('theme-switcher');
            const icon = themeSwitcher.querySelector('i');
            const doc = document.documentElement;

            // Set initial icon based on current theme
            if (doc.getAttribute('data-theme') === 'dark') {
                icon.classList.replace('fa-moon', 'fa-sun');
            }

            themeSwitcher.addEventListener('click', function () {
                const currentTheme = doc.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                doc.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);

                icon.classList.toggle('fa-moon');
                icon.classList.toggle('fa-sun');
            });

            // Set current year in footer
            const currentYearElement = document.getElementById('current-year');
            if (currentYearElement) {
                currentYearElement.textContent = new Date().getFullYear();
            }

            // Show toast for cart notifications
            const alerts = document.querySelectorAll('.alert-info');
            if (alerts.length > 0) {
                const toast = new bootstrap.Toast(document.getElementById('cartToast'));
                toast.show();
            }
        });
    </script>

    <!-- Contact Modal -->
    <div class="modal fade" id="contactModal" tabindex="-1" aria-labelledby="contactModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="contactModalLabel">Contact Us</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form action="{{ url_for('contact') }}" method="post">
                        <div class="mb-3">
                            <label for="name" class="form-label">Name</label>
                            <input type="text" class="form-control" id="name" name="name" required>
                        </div>
                        <div class="mb-3">
                            <label for="email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="email" name="email" required>
                        </div>
                        <div class="mb-3">
                            <label for="category" class="form-label">Category</label>
                            <select class="form-control" id="category" name="category" required>
                                <option value="">Select a category</option>
                                <option value="General Inquiry">General Inquiry</option>
                                <option value="Product Issues">Product Issues</option>
                                <option value="Shipping & Delivery">Shipping & Delivery</option>
                                <option value="Returns & Refunds">Returns & Refunds</option>
                                <option value="Technical Support">Technical Support</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="message" class="form-label">Message</label>
                            <textarea class="form-control" id="message" name="message" rows="3" required></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Send Message</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
